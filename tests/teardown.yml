---
- name: create hosts for role test
  hosts: localhost
  gather_facts: no
  connection: local

  vars:
    droplet: "{{ lookup('file', cache_dir + '/droplet') | from_json }}"
    ssh_key: "{{ lookup('file', cache_dir + '/ssh_key') | from_json }}"

  vars_files:
    - common.yml
    - secret.yml

  tasks:
    - name: destroy droplet
      digital_ocean_droplet:
        state: absent
        id: "{{ droplet.id }}"
        oauth_token: "{{ digitalocean_api_key }}"
        wait_timeout: 500

    - name: delete ssh key
      digital_ocean_sshkey:
        state: absent
        fingerprint: "{{ ssh_key.fingerprint }}"
        oauth_token: "{{ digitalocean_api_key }}"

    - name: destroy cache directory
      file:
        path: "{{ cache_dir }}"
        state: absent
