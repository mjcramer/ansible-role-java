---
- name: create ssh key
  digital_ocean_sshkey:
    oauth_token: "{{ digitalocean_api_key }}"
    name: "{{ ssh_key_name }}"
    ssh_pub_key: "{{ lookup('file', ssh_public_key_file) }}"
    state: present
  register: key

- name: create a new droplet
  digital_ocean_droplet:
    state: present
    name: "{{ droplet_name }}"
    unique_name: yes
    size: 2gb
    region: sfo2
    image: "{{ droplet_os }}"
    ssh_keys: 
    - "{{ key.data.ssh_key.id }}"
    oauth_token: "{{ digitalocean_api_key }}"
    wait_timeout: 500
    monitoring: no
  register: droplet
