---
- name: wait for machines to boot
  hosts: localhost
  gather_facts: no
  connection: local

  vars_files:
    - common.yml

  vars:
    droplet_ids: "{{ lookup('file', cache_dir + '/droplet_ids') | from_json }}"

  tasks:
    - name: wait for ssh on instances
      wait_for:
        delay: 1
        host: "{{ item }}"
        port: 22
        state: started
        timeout: 60
      loop: "{{ droplet_ids }}"

- name: apply role to instance
  hosts: java_hosts
  
  roles:
    - role: ../../ansible-role-java
      become: yes

  tasks:
    - debug:
        var: java_home
